{"content":"<h1 id=\"前端资源错误导致页面白屏监控预警方案\">前端资源错误导致页面白屏监控预警方案</h1>\n<h2 id=\"前端资源错误表现为：\">前端资源错误表现为：</h2>\n<blockquote>\n<p>1.代码异常、数据处理异常<br>2.ajax 请求异常<br>3.浏览器静态资源加载异常<br>4.页面崩溃、卡顿</p>\n</blockquote>\n<h2 id=\"局部处理\">局部处理</h2>\n<p>代码块的语法异常： try...catch\n对那些可能存在错误的语句块使用 try-catch\nPromise 的异常捕获，catch</p>\n<h2 id=\"全局处理-借助-sourcemap-定位问题\">全局处理 借助 sourcemap 定位问题</h2>\n<ul>\n<li>Window.onerror<ol>\n<li>全局捕获，写在代码最前面</li>\n<li>无法捕获到网络异常</li>\n<li>无法捕获 promise 抛出的异常</li>\n</ol>\n</li>\n<li>Window.addEventListener<ol>\n<li>Error : 全局监听错误</li>\n<li>Unhandledrejection ：全局监听 Uncaught promise Error</li>\n<li>Ajax 全局异常处理函数</li>\n</ol>\n</li>\n<li>Vue.config.errorHandler<ol>\n<li>无法捕获 promise 抛出的异常</li>\n<li>无法捕获到网络异常</li>\n</ol>\n</li>\n<li>React componentDidCatch<ol>\n<li>无法捕获事件处理</li>\n<li>无法捕获异步代码</li>\n<li>无法捕获服务端渲染</li>\n<li>无法捕获自身组件的错误</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"service-worker\">service worker</h2>\n<ol>\n<li>注册一个 service worker，配合 load 和 beforeunload 事件，监听页面是否加载完，是否崩溃。</li>\n<li>service worker 打点，监听页面的延迟和崩溃。js 主线程实时向 service worker 发送信息，在设置的延迟和崩溃时间内判断页面的加载状态\n错误上报</li>\n</ol>\n<ul>\n<li>一、ajax 向服务器发送搜集的错误信息<ol>\n<li>缺点：发送数据的同时也会出现网络问题，同步的上报可能导致页面延迟；</li>\n<li>优点：不存在兼容问题</li>\n</ol>\n</li>\n<li>二、动态创建 img 标签上报</li>\n<li>三、Navigator.sendBeancon 通过 HTTP 将少量数据异步传输到 Web 服务器\nIE 不兼容，但是数据传输可靠，关闭浏览器也能发送异步请求，不影响页面的加载。</li>\n</ul>\n<h2 id=\"问题\">问题</h2>\n<p><strong>1.</strong> 如果断网没上报成功 需要有个本地存储，有网络或者下次上报的时候一起带上去<br><strong>2.</strong> 确保错误上传到服务器，浏览器不支持 serice worker 如何处理</p>\n<h2 id=\"上报流程图\">上报流程图</h2>\n<pre><code class=\"hljs mermaid\">graph LR\n    1(客户端) --&gt; | 定时发送2s未收到则页面白屏5s未收到则页面崩溃 | 2(service worker)\n    2 --&gt; | 否 | 3[服务端]\n    4(jsError)--&gt;5{兼容navigator.sendBeancon}\n    5 --&gt; | 是sendeErrorData | 3[服务端]\n    5 --&gt; | 否 | 6[img/ajax]\n    6 --&gt; | endeErrorData | 3[服务端]\n</code></pre>\n","fileName":"handlePageError"}